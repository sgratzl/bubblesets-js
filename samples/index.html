<!DOCTYPE html>
<html lang="en">
  <head>
    <title>BubbleSets - Playground</title>
    <meta charset="utf-8" />
    <script src="https://unpkg.com/d3"></script>
    <script src="../dist/bubblesets.umd.development.js"></script>
  </head>
  <body>
    <h3>BubbleSets for JavaScript</h3>
    <p>
      Add rectangles by clicking with the left or right mouse button on the canvas.
    </p>
    <svg id="main" style="width: 90vw; height: 80vh; margin: 0 auto; border: 1px solid black;"></svg>

    <script>
      const bubbles = new BubbleSets.BubbleSet();
      const rectanglesA = [];
      const rectanglesB = [];
      const main = d3.select('#main');
      const items = main.append('g');
      const pathA = main.append('path');
      const pathB = main.append('path');

      function update() {
        updateOutline(rectanglesA, rectanglesB, 'crimson', pathA);
        updateOutline(rectanglesB, rectanglesA, 'cornflowerblue', pathB);
      }

      function updateOutline(rectangles, otherRectangles, color, path) {
        const pad = 5;
        const pointPath = bubbles.createOutline(
          rectangles.map((r) => BubbleSets.addPadding(r, pad)),
          otherRectangles.map((r) => BubbleSets.addPadding(r, pad)),
          []
        );
        // rectangles need to have the form { x: 0, y: 0, width: 0, height: 0 }
        // lines need to have the form { x1: 0, x2: 0, y1: 0, y2: 0 }
        // lines can be null to infer lines between rectangles automatically
        const outline = pointPath;
        // .apply(BubbleSets.shapeSimplifier(0))
        // .apply(BubbleSets.bSplineShapeGenerator(0))
        // .apply(BubbleSets.shapeSimplifier(0));
        path.attr('d', outline);
        path.style('opacity', 0.5).style('fill', color).style('stroke', 'black');
      }

      function addRect(rectangles, color, cx, cy) {
        const width = 40;
        const height = 30;
        const x = cx - width * 0.5;
        const y = cy - height * 0.5;
        const elem = items.append('rect');
        elem.attr('x', x).attr('y', y).attr('width', width).attr('height', height);
        elem.style('stroke', 'black').style('stroke-width', 1).style('fill', color);
        rectangles.push(new BubbleSets.Rectangle(x, y, width, height));
        update();
      }

      main.on('click', () => {
        addRect(rectanglesA, 'cornflowerblue', d3.event.offsetX, d3.event.offsetY);
      });
      var oldX = Number.NaN;
      var oldY = Number.NaN;
      main.on('contextMenu', () => {
        if (oldX === e.offsetX && oldY === e.offsetY) return;
        oldX = e.offsetX;
        oldY = e.offsetY;
        addRect(rectanglesB, 'crimson', e.offsetX, e.offsetY);
        e.preventDefault();
      });
    </script>
  </body>
</html>
